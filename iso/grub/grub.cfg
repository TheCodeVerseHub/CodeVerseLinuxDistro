# CVH Linux GRUB Configuration

set default=0
set timeout=5
set gfxmode=auto
set gfxpayload=keep

# Load video modules
insmod all_video
insmod gfxterm
insmod png

# Set terminal
terminal_output gfxterm

# Load Tela theme
# Try multiple paths for compatibility
if [ -f /boot/grub/themes/tela/theme.txt ]; then
    set theme=/boot/grub/themes/tela/theme.txt
elif [ -f $prefix/themes/tela/theme.txt ]; then
    set theme=$prefix/themes/tela/theme.txt
elif [ -f ($root)/grub/themes/tela/theme.txt ]; then
    set theme=($root)/grub/themes/tela/theme.txt
fi
export theme

# Fallback colors (Nord palette) if theme fails to load
set color_normal=white/black
set color_highlight=cyan/black

# Menu entries
menuentry "CVH Linux (Live)" --class cvh --class gnu-linux --class os {
    set gfxpayload=keep
    linux /cvh/boot/x86_64/vmlinuz-linux archisobasedir=cvh archisolabel=%ARCHISO_LABEL% quiet splash
    initrd /cvh/boot/x86_64/initramfs-linux.img
}

menuentry "CVH Linux (Live, Copy to RAM)" --class cvh --class gnu-linux --class os {
    set gfxpayload=keep
    linux /cvh/boot/x86_64/vmlinuz-linux archisobasedir=cvh archisolabel=%ARCHISO_LABEL% copytoram=y quiet splash
    initrd /cvh/boot/x86_64/initramfs-linux.img
}

menuentry "CVH Linux (Live, Safe Graphics)" --class cvh --class gnu-linux --class os {
    set gfxpayload=keep
    linux /cvh/boot/x86_64/vmlinuz-linux archisobasedir=cvh archisolabel=%ARCHISO_LABEL% nomodeset quiet
    initrd /cvh/boot/x86_64/initramfs-linux.img
}

menuentry "CVH Linux (Live, Verbose Boot)" --class cvh --class gnu-linux --class os {
    set gfxpayload=keep
    linux /cvh/boot/x86_64/vmlinuz-linux archisobasedir=cvh archisolabel=%ARCHISO_LABEL%
    initrd /cvh/boot/x86_64/initramfs-linux.img
}

menuentry "" {
    # Separator
}

menuentry "UEFI Firmware Settings" --class efi {
    fwsetup
}

menuentry "Reboot" --class restart {
    reboot
}

menuentry "Shutdown" --class shutdown {
    halt
}
